# Get the host object
    $host = Get-VMHost

    # Get the network adapter object
    $adapter = Get-VMHostNetworkAdapter -VMHost $host -Name $AdapterName

    # Create a new virtual switch
    New-VirtualSwitch -VMHost $host -Name $SwitchName -NumPorts 128 -Confirm:$false

    # Create a new port group on the virtual switch
    New-VirtualPortGroup -VirtualSwitch (Get-VirtualSwitch -VMHost $host -Name $SwitchName) -Name $PortGroupName -VLanId 0

    # Create a new virtual NIC and connect it to the port group
    $nic = New-VMHostNetworkAdapter -PortGroup $PortGroupName -VirtualSwitch $SwitchName -VMHost $host -Confirm:$false

    # Configure the IP address and subnet mask on the virtual NIC
    $nic | Set-VMHostNetworkAdapter -IP $AdapterIPAddress -SubnetMask $AdapterSubnetMask -Confirm:$false
